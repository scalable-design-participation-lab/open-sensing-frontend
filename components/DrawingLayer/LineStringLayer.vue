<template>
  <ol-feature v-for="feature in lineStringFeatures" :key="feature.id">
    <ol-geom-line-string :coordinates="feature.coordinates" />
    <ol-style>
      <ol-style-stroke color="red" :width="2" :line-dash="[6, 6]" />
    </ol-style>
  </ol-feature>

  <ol-overlay
    v-for="feature in lineStringFeatures"
    :key="`start-${feature.id}`"
    :position="getLineStringStartPoint(feature)"
    :offset="[0, 0]"
  >
    <div class="prohibit-icon" @click.stop="toggleCommentPopup(feature)">
      <svg
        width="43"
        height="43"
        viewBox="0 0 43 43"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M34.6688 2.58579C33.8877 1.80474 32.6214 1.80474 31.8404 2.58579L21.0299 13.3963L10.5028 2.86919C9.72177 2.08815 8.45544 2.08815 7.67439 2.86919L2.58579 7.9578C1.80474 8.73885 1.80474 10.0052 2.58579 10.7862L13.1129 21.3133L3.00067 31.4255C2.21962 32.2065 2.21962 33.4729 3.00067 34.2539L8.08927 39.3425C8.87032 40.1236 10.1367 40.1236 10.9177 39.3425L21.0299 29.2303L31.4255 39.6259C32.2065 40.407 33.4729 40.407 34.2539 39.6259L39.3425 34.5373C40.1236 33.7563 40.1236 32.4899 39.3425 31.7089L28.9469 21.3133L39.7574 10.5028C40.5384 9.72177 40.5384 8.45544 39.7574 7.67439L34.6688 2.58579Z"
          fill="#E23636"
        />
        <path
          d="M31.8404 2.58579L30.4262 1.17157V1.17157L31.8404 2.58579ZM34.6688 2.58579L36.083 1.17157L36.083 1.17157L34.6688 2.58579ZM21.0299 13.3963L19.6157 14.8105L21.0299 16.2247L22.4441 14.8105L21.0299 13.3963ZM10.5028 2.86919L11.917 1.45498V1.45498L10.5028 2.86919ZM7.67439 2.86919L6.26018 1.45498L6.26018 1.45498L7.67439 2.86919ZM2.58579 7.9578L1.17157 6.54359L1.17157 6.54359L2.58579 7.9578ZM2.58579 10.7862L1.17157 12.2004H1.17157L2.58579 10.7862ZM13.1129 21.3133L14.5271 22.7275L15.9413 21.3133L14.5271 19.8991L13.1129 21.3133ZM3.00067 31.4255L4.41488 32.8397L4.41488 32.8397L3.00067 31.4255ZM3.00067 34.2539L1.58645 35.6681L1.58645 35.6681L3.00067 34.2539ZM8.08927 39.3425L6.67506 40.7567H6.67506L8.08927 39.3425ZM10.9177 39.3425L9.50349 37.9283L9.50348 37.9283L10.9177 39.3425ZM21.0299 29.2303L22.4441 27.8161L21.0299 26.4019L19.6157 27.8161L21.0299 29.2303ZM31.4255 39.6259L30.0113 41.0401L31.4255 39.6259ZM34.2539 39.6259L35.6681 41.0401H35.6681L34.2539 39.6259ZM39.3425 34.5373L40.7567 35.9515V35.9515L39.3425 34.5373ZM39.3425 31.7089L37.9283 33.1231L37.9283 33.1231L39.3425 31.7089ZM28.9469 21.3133L27.5327 19.8991L26.1185 21.3133L27.5327 22.7275L28.9469 21.3133ZM39.7574 10.5028L41.1716 11.917V11.917L39.7574 10.5028ZM39.7574 7.67439L41.1716 6.26018V6.26018L39.7574 7.67439ZM33.2546 4L33.2546 4L36.083 1.17157C34.5209 -0.390523 31.9883 -0.390525 30.4262 1.17157L33.2546 4ZM22.4441 14.8105L33.2546 4L30.4262 1.17157L19.6157 11.9821L22.4441 14.8105ZM9.08861 4.28341L19.6157 14.8105L22.4441 11.9821L11.917 1.45498L9.08861 4.28341ZM9.08861 4.28341L9.08861 4.28341L11.917 1.45498C10.3549 -0.107115 7.82228 -0.107118 6.26018 1.45498L9.08861 4.28341ZM4 9.37201L9.08861 4.28341L6.26018 1.45498L1.17157 6.54359L4 9.37201ZM4 9.37201H4L1.17157 6.54359C-0.390523 8.10568 -0.390525 10.6383 1.17157 12.2004L4 9.37201ZM14.5271 19.8991L4 9.37201L1.17157 12.2004L11.6986 22.7275L14.5271 19.8991ZM4.41488 32.8397L14.5271 22.7275L11.6986 19.8991L1.58645 30.0113L4.41488 32.8397ZM4.41488 32.8397L4.41488 32.8397L1.58645 30.0113C0.024357 31.5734 0.0243565 34.106 1.58645 35.6681L4.41488 32.8397ZM9.50349 37.9283L4.41488 32.8397L1.58645 35.6681L6.67506 40.7567L9.50349 37.9283ZM9.50348 37.9283L9.50349 37.9283L6.67506 40.7567C8.23715 42.3188 10.7698 42.3188 12.3319 40.7567L9.50348 37.9283ZM19.6157 27.8161L9.50349 37.9283L12.3319 40.7567L22.4441 30.6445L19.6157 27.8161ZM32.8397 38.2117L22.4441 27.8161L19.6157 30.6445L30.0113 41.0401L32.8397 38.2117ZM32.8397 38.2117H32.8397L30.0113 41.0401C31.5734 42.6022 34.106 42.6022 35.6681 41.0401L32.8397 38.2117ZM37.9283 33.1231L32.8397 38.2117L35.6681 41.0401L40.7567 35.9515L37.9283 33.1231ZM37.9283 33.1231L37.9283 33.1231L40.7567 35.9515C42.3188 34.3894 42.3188 31.8568 40.7567 30.2947L37.9283 33.1231ZM27.5327 22.7275L37.9283 33.1231L40.7567 30.2947L30.3611 19.8991L27.5327 22.7275ZM38.3432 9.08861L27.5327 19.8991L30.3611 22.7275L41.1716 11.917L38.3432 9.08861ZM38.3432 9.0886V9.08861L41.1716 11.917C42.7337 10.3549 42.7337 7.82228 41.1716 6.26018L38.3432 9.0886ZM33.2546 4L38.3432 9.08861L41.1716 6.26018L36.083 1.17157L33.2546 4Z"
          fill="black"
        />
      </svg>
    </div>
  </ol-overlay>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useMapUIStore } from '@/stores/mapUI'

const emit = defineEmits(['toggle-comment-popup'])

const mapUIStore = useMapUIStore()

const lineStringFeatures = computed(() =>
  mapUIStore.features.filter((feature) => feature.type === 'LineString')
)

function getLineStringStartPoint(feature) {
  if (feature.coordinates.length > 0) {
    return feature.coordinates[0]
  }
  return [0, 0]
}

function toggleCommentPopup(feature) {
  emit('toggle-comment-popup', feature)
}
</script>

<style scoped>
.prohibit-icon {
  cursor: pointer;
}
</style>
